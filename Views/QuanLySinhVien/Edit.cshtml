@model KTX.Entities.SinhVien

@{
    ViewData["Title"] = "Chỉnh sửa thông tin sinh viên";
    Layout = "~/Views/Shared/LayoutAdmin.cshtml";
}

<div class="container mt-4">
    <h3 class="fw-bold mb-3 text-primary">
        <i class="bi bi-pencil-square me-2"></i>Chỉnh sửa thông tin sinh viên
    </h3>

    <form asp-action="Edit" method="post" enctype="multipart/form-data" class="row g-3 shadow-sm p-4 rounded bg-light">
        @Html.AntiForgeryToken()
        <input asp-for="Msv" type="hidden" />

        <!-- Avatar hiện tại -->
        @if (!string.IsNullOrEmpty(Model.Avatar))
        {
            <div class="col-12 text-center mb-3">
                <img src="~/images/@Model.Avatar" alt="Avatar" class="rounded-circle img-thumbnail" style="width: 120px; height: 120px; object-fit: cover;">
                <p class="text-muted small mt-2">Avatar hiện tại</p>
            </div>
        }

        <!-- Họ tên -->
        <div class="col-md-6">
            <label asp-for="HoTen" class="form-label fw-semibold required">Họ và tên</label>
            <input asp-for="HoTen" class="form-control" required />
            <span asp-validation-for="HoTen" class="text-danger small"></span>
        </div>

        <!-- Ngày sinh -->
        <div class="col-md-6">
            <label asp-for="NgaySinh" class="form-label fw-semibold">Ngày sinh</label>
            <input asp-for="NgaySinh" type="date" class="form-control" />
            <span asp-validation-for="NgaySinh" class="text-danger small"></span>
        </div>

        <!-- Giới tính -->
        <div class="col-md-6">
            <label asp-for="GioiTinh" class="form-label fw-semibold">Giới tính</label>
            <select asp-for="GioiTinh" class="form-select">
                <option value="">-- Chọn giới tính --</option>
                <option value="Nam">Nam</option>
                <option value="Nữ">Nữ</option>
                <option value="Khác">Khác</option>
            </select>
            <span asp-validation-for="GioiTinh" class="text-danger small"></span>
        </div>

        <!-- Số điện thoại -->
        <div class="col-md-6">
            <label asp-for="Sdt" class="form-label fw-semibold required">Số điện thoại</label>
            <input asp-for="Sdt" class="form-control" required />
            <span asp-validation-for="Sdt" class="text-danger small"></span>
        </div>

        <!-- Email -->
        <div class="col-md-6">
            <label asp-for="Email" class="form-label fw-semibold">Email</label>
            <input asp-for="Email" type="email" class="form-control" />
            <span asp-validation-for="Email" class="text-danger small"></span>
        </div>

        <!-- Khoa -->
        <div class="col-md-6">
            <label asp-for="Khoa" class="form-label fw-semibold">Khoa</label>
            <select asp-for="Khoa" class="form-select">
                <option value="">-- Chọn khoa --</option>
                <option value="Công nghệ thông tin">Công nghệ thông tin</option>
                <option value="Kinh tế">Kinh tế</option>
                <option value="Kỹ thuật">Kỹ thuật</option>
                <option value="Ngoại ngữ">Ngoại ngữ</option>
                <option value="Khoa học tự nhiên">Khoa học tự nhiên</option>
                <option value="Y dược">Y dược</option>
                <option value="Luật">Luật</option>
                <option value="Sư phạm">Sư phạm</option>
                <option value="Nghệ thuật">Nghệ thuật</option>
            </select>
            <span asp-validation-for="Khoa" class="text-danger small"></span>
        </div>

        <!-- Upload avatar mới -->
        <div class="col-md-12">
            <label class="form-label fw-semibold">
                <i class="bi bi-image me-2"></i>Đổi ảnh đại diện
            </label>
            <input type="file" name="avatarFile" id="avatarFile" class="form-control" accept="image/*" />
            <small class="text-muted">Để trống nếu không muốn thay đổi. Chấp nhận: .jpg, .jpeg, .png, .gif</small>

            <!-- Preview ảnh mới -->
            <div id="imagePreview" class="mt-3" style="display: none;">
                <p class="mb-2 text-muted">Ảnh mới:</p>
                <img id="previewImg" src="" alt="Preview" class="img-thumbnail" style="max-width: 200px; max-height: 200px;">
            </div>
        </div>

        <!-- Nút hành động -->
        <div class="col-12 d-flex justify-content-between mt-4">
            <a asp-action="Details" asp-route-id="@Model.Msv" class="btn btn-outline-secondary">
                <i class="bi bi-arrow-left me-2"></i>Quay lại
            </a>
            <button type="submit" class="btn btn-primary">
                <i class="bi bi-save me-2"></i>Lưu thay đổi
            </button>
        </div>
    </form>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        // Preview ảnh khi chọn file
        document.getElementById('avatarFile').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                // Kiểm tra dung lượng
                if (file.size > 5 * 1024 * 1024) {
                    alert('File ảnh quá lớn! Vui lòng chọn file dưới 5MB.');
                    e.target.value = '';
                    document.getElementById('imagePreview').style.display = 'none';
                    return;
                }

                // Kiểm tra định dạng
                const validTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif'];
                if (!validTypes.includes(file.type)) {
                    alert('Chỉ chấp nhận file ảnh!');
                    e.target.value = '';
                    document.getElementById('imagePreview').style.display = 'none';
                    return;
                }

                // Hiển thị preview
                const reader = new FileReader();
                reader.onload = function(event) {
                    document.getElementById('previewImg').src = event.target.result;
                    document.getElementById('imagePreview').style.display = 'block';
                };
                reader.readAsDataURL(file);
            } else {
                document.getElementById('imagePreview').style.display = 'none';
            }
        });
    </script>
}

<style>
    .required::after {
        content: " *";
        color: red;
    }
</style>