@model KTX.Models.ViewModels.HomeViewModel

@{
    ViewData["Title"] = "Trang Chủ";
}



@section Styles {
    <link href="~/css/Home.css" rel="stylesheet" />
}

<div class="main-container">
    <!-- A. Welcome Section -->
    <div class="welcome-section">
        <div class="welcome-content">
            <h1>
                <span class="wave">👋</span>
                Xin chào, @Model.SinhVien1?.HoTen!
            </h1>
            <p>✨ Chúc bạn một ngày tốt lành tại Ký túc xá GTVT!</p>
        </div>
        <div class="welcome-illustration">
            🏢
        </div>
    </div>

    <!-- B. Dashboard Statistics -->
    <div class="stats-container">
        <div class="stat-card blue">
            <div class="stat-icon-wrapper">💰</div>
            <div class="stat-label">Giá thuê phòng</div>
            <div class="stat-value">@((Model.HopDong1?.TienP ?? 0).ToString("N0"))đ</div>
            <div class="stat-subtitle">Số tiền/tháng</div>
        </div>

        <div class="stat-card green">
            <div class="stat-icon-wrapper">🏡</div>
            <div class="stat-label">Phòng hiện tại</div>
            <div class="stat-value">
                @(Model.HopDong1?.MaP.ToString() ?? "---")
            </div>
            <div class="stat-subtitle">Phòng đang ở</div>
        </div>

        <div class="stat-card orange">
            <div class="stat-icon-wrapper">📄</div>
            <div class="stat-label">Hợp đồng hết hạn</div>
            <div class="stat-value" style="font-size: 20px;">
                @Model.HopDong1?.NgayKetThuc
            </div>
            <div class="stat-subtitle">Ngày kết thúc</div>
        </div>

        <div class="stat-card purple">
            <div class="stat-icon-wrapper">⚙️</div>
            <div class="stat-label">Yêu cầu</div>
            <div class="stat-value">@Model.YeuCauds.Count()</div>
            <div class="stat-subtitle">Đang xử lý</div>
        </div>
    </div>

    <!-- C. Content Grid -->
    <div class="content-grid">
        <!-- Notifications Section -->
        <div class="section-card">
            <div class="section-header">
                <h2 class="section-title">
                    <span class="section-icon"><i class="bi bi-bell-fill"></i></span>
                    Thông báo gần đây
                </h2>
                <a href="#" class="section-action">
                    <i class="bi bi-arrow-right-circle"></i>
                    Xem tất cả
                </a>
            </div>
            <div class="section-body">
                @if (Model.Thongbaods.Any())
                {
                    @foreach (var tb in Model.Thongbaods.Take(4))
                    {
                        <div class="notification-item">
                            <div class="notification-header">
                                <div class="notification-title">@tb.TieuDe</div>
                                <span class="notification-badge">Mới</span>
                            </div>
                            <div class="notification-meta">
                                <span><i class="bi bi-calendar3"></i>@tb.NgayTb</span>
                            </div>
                            <div class="notification-content">
                                @(tb.NoiDung?.Length > 100 ? tb.NoiDung.Substring(0, 100) + "..." : tb.NoiDung)
                            </div>
                        </div>
                    }
                }
                else
                {
                    <div class="empty-state">
                        <div class="empty-icon">📭</div>
                        <div class="empty-title">Chưa có thông báo</div>
                        <p class="empty-text">Bạn sẽ nhận được thông báo mới tại đây</p>
                    </div>
                }
            </div>
        </div>

        <!-- Requests Section -->
        <div class="section-card">
            <div class="section-header">
                <h2 class="section-title">
                    <span class="section-icon"><i class="bi bi-clipboard-check-fill"></i></span>
                    Yêu cầu của bạn
                </h2>
                <a href="#" class="section-action">
                    <i class="bi bi-plus-circle"></i>
                    Tạo yêu cầu
                </a>
            </div>
            <div class="section-body">
                @if (Model.YeuCauds.Any())
                {
                    @foreach (var yc in Model.YeuCauds.Take(4))
                    {
                        <div class="request-item">
                            <div class="request-info">
                                <div class="request-type">@yc.LoaiYc</div>
                                <div class="request-date">
                                    <i class="bi bi-clock-fill"></i>
                                    @yc.NgayGuiYc
                                </div>
                            </div>
                            <span class="status-badge status-@(yc.TrangThaiYc == "Đã xử lý" ? "completed" : yc.TrangThaiYc == "Đang xử lý" ? "processing" : "pending")">
                                @yc.TrangThaiYc
                            </span>
                        </div>
                    }
                }
                else
                {
                    <div class="empty-state">
                        <div class="empty-icon">📝</div>
                        <div class="empty-title">Chưa có yêu cầu</div>
                        <p class="empty-text">Bạn chưa gửi yêu cầu nào</p>
                        <a href="#" class="btn-primary-custom">
                            <i class="bi bi-plus-circle"></i>
                            Gửi yêu cầu đầu tiên
                        </a>
                    </div>
                }
            </div>
        </div>
    </div>

    <!-- Contract Section -->
    <div class="section-full">
        <div class="section-header">
            <h2 class="section-title">
                <span class="section-icon"><i class="bi bi-file-text-fill"></i></span>
                Hợp đồng phòng hiện tại
            </h2>
            <a href="#" class="section-action">
                <i class="bi bi-info-circle"></i>
                Chi tiết hợp đồng
            </a>
        </div>
        <div class="section-body">
            @if (Model.HopDong1 != null)
            {
                <div class="contract-grid">
                    <div class="contract-item">
                        <div class="contract-icon">
                            <i class="bi bi-door-open-fill"></i>
                        </div>
                        <div class="contract-info">
                            <div class="contract-label">Phòng</div>
                            <div class="contract-value">@Model.HopDong1.MaP</div>
                        </div>
                    </div>

                    <div class="contract-item">
                        <div class="contract-icon">
                            <i class="bi bi-calendar-range-fill"></i>
                        </div>
                        <div class="contract-info">
                            <div class="contract-label">Ngày bắt đầu</div>
                            <div class="contract-value" style="font-size: 15px;">
                                @Model.HopDong1.NgayBatDau
                            </div>
                        </div>
                    </div>

                    <div class="contract-item">
                        <div class="contract-icon">
                            <i class="bi bi-calendar-check-fill"></i>
                        </div>
                        <div class="contract-info">
                            <div class="contract-label">Ngày kết thúc</div>
                            <div class="contract-value" style="font-size: 15px;">
                                @Model.HopDong1.NgayKetThuc
                            </div>
                        </div>
                    </div>

                    <div class="contract-item">
                        <div class="contract-icon">
                            <i class="bi bi-piggy-bank-fill"></i>
                        </div>
                        <div class="contract-info">
                            <div class="contract-label">Tiền cọc</div>
                            <div class="contract-value" style="font-size: 15px;">
                                @((Model.HopDong1.TienCoc ?? 0).ToString("N0")) đ
                            </div>
                        </div>
                    </div>

                    <div class="contract-item">
                        <div class="contract-icon">
                            <i class="bi bi-cash-stack"></i>
                        </div>
                        <div class="contract-info">
                            <div class="contract-label">Giá thuê</div>
                            <div class="contract-value" style="font-size: 15px;">
                                @((Model.HopDong1.TienP ?? 0).ToString("N0")) đ/tháng
                            </div>
                        </div>
                    </div>

                    <div class="contract-item">
                        <div class="contract-icon">
                            <i class="bi bi-pen-fill"></i>
                        </div>
                        <div class="contract-info">
                            <div class="contract-label">Ngày ký</div>
                            <div class="contract-value" style="font-size: 15px;">
                                @Model.HopDong1.NgayKi
                            </div>
                        </div>
                    </div>

                    <div class="contract-item">
                        <div class="contract-icon">
                            <i class="bi bi-check-circle-fill"></i>
                        </div>
                        <div class="contract-info">
                            <div class="contract-label">Trạng thái</div>
                            <div class="contract-value">
                                <span class="badge bg-success" style="font-size: 14px;">✓ Hoạt động</span>
                            </div>
                        </div>
                    </div>

                    <div class="contract-item">
                        <div class="contract-icon">
                            <i class="bi bi-person-badge-fill"></i>
                        </div>
                        <div class="contract-info">
                            <div class="contract-label">Mã sinh viên</div>
                            <div class="contract-value" style="font-size: 15px;">
                                @Model.HopDong1.Msv
                            </div>
                        </div>
                    </div>
                </div>
            }
            else
            {
                <div class="empty-state">
                    <div class="empty-icon">📄</div>
                    <div class="empty-title">Chưa có hợp đồng</div>
                    <p class="empty-text">Bạn chưa có hợp đồng phòng nào đang hoạt động</p>
                    <a href="#" class="btn-primary-custom">
                        <i class="bi bi-file-earmark-plus"></i>
                        Đăng ký phòng mới
                    </a>
                </div>
            }
        </div>
    </div>

    <!-- Community Posts Section -->
    <div class="section-full">
        <div class="section-header">
            <h2 class="section-title">
                <span class="section-icon"><i class="bi bi-chat-dots-fill"></i></span>
                Bài đăng cộng đồng
            </h2>
            <a asp-controller="CongDong" asp-action="Index" class="section-action">
                <i class="bi bi-chat-left-text-fill"></i>
                Xem diễn đàn
            </a>
        </div>
        <div class="section-body">
            @if (Model.BaiDangds.Any())
            {
                @foreach (var bd in Model.BaiDangds.Take(4))
                {
                    <span class="post-meta-item">
                        <i class="bi bi-person-circle"></i>
                        <h5 class="mb-0 fw-semibold text-success">@bd.Msv</h5>
                        <span class="post-meta-item">
                            <i class="bi bi-calendar3"></i>
                            @bd.NgayDang
                        </span>
                     
                    </span>
                    <div class="post-item">
                        <div class="post-content">
                            @bd.NoiDungBd
                        </div>
                        <div class="post-meta">
                            <span class="post-meta-item">
                                @if (bd.TraLois != null && bd.TraLois.Any())
                                {
                                    <ul>
                                        @foreach (var traLoi in bd.TraLois.Take(3))
                                        {
                                            
                                            <li class="list-group">
                                               
                                                <strong class="bi bi-person-circle"> : @traLoi.Msv</strong> @traLoi.NoiDungTl
                                                
                                            </li>
                                        }
                                    </ul>
                                }
                                else
                                {
                                    <span>Chưa có trả lời</span>
                                }
                            </span>
                        </div>
                    </div>
                }
            }
            else
            {
                <div class="empty-state">
                    <div class="empty-icon">💬</div>
                    <div class="empty-title">Chưa có bài đăng</div>
                    <p class="empty-text">Hãy là người đầu tiên chia sẻ trong cộng đồng</p>
                    <a asp-controller="CongDong" asp-action="Index" class="btn-primary-custom">
                        <i class="bi bi-plus-circle"></i>
                        Đăng bài mới
                    </a>
                </div>
            }
        </div>
    </div>
</div>

<!-- Bootstrap Icons -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">

<script>
    // Add smooth scroll behavior
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
            e.preventDefault();
            const target = document.querySelector(this.getAttribute('href'));
            if (target) {
                target.scrollIntoView({
                    behavior: 'smooth',
                    block: 'start'
                });
            }
        });
    });

    // Add animation on scroll
    const observerOptions = {
        threshold: 0.1,
        rootMargin: '0px 0px -50px 0px'
    };

    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.style.opacity = '1';
                entry.target.style.transform = 'translateY(0)';
            }
        });
    }, observerOptions);

    document.querySelectorAll('.section-card, .section-full').forEach(el => {
        el.style.opacity = '0';
        el.style.transform = 'translateY(20px)';
        el.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
        observer.observe(el);
    });

    // Real-time clock for welcome message
    function updateTime() {
        const now = new Date();
        const hours = now.getHours();
        let greeting = 'Chào buổi sáng';

        if (hours >= 12 && hours < 18) {
            greeting = 'Chào buổi chiều';
        } else if (hours >= 18) {
            greeting = 'Chào buổi tối';
        }

        const welcomeText = document.querySelector('.welcome-content p');
        if (welcomeText && !welcomeText.dataset.modified) {
            welcomeText.innerHTML = `✨ ${greeting}! Chúc bạn một ngày tốt lành tại Ký túc xá GTVT!`;
            welcomeText.dataset.modified = 'true';
        }
    }

    updateTime();

    // Add click effect to cards
    document.querySelectorAll('.stat-card, .notification-item, .request-item, .post-item, .contract-item').forEach(card => {
        card.addEventListener('click', function() {
            this.style.transform = 'scale(0.98)';
            setTimeout(() => {
                this.style.transform = '';
            }, 200);
        });
    });

    // Notification count animation
    const statValues = document.querySelectorAll('.stat-value');
    statValues.forEach(stat => {
        const value = stat.textContent;
        if (!isNaN(parseInt(value))) {
            const finalValue = parseInt(value.replace(/[^0-9]/g, ''));
            let currentValue = 0;
            const increment = finalValue / 50;
            const timer = setInterval(() => {
                currentValue += increment;
                if (currentValue >= finalValue) {
                    currentValue = finalValue;
                    clearInterval(timer);
                }
                const formattedValue = Math.floor(currentValue).toLocaleString('vi-VN');
                stat.textContent = value.includes('đ') ? formattedValue + 'đ' : formattedValue;
            }, 20);
        }
    });
</script>